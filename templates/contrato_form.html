{% extends 'layout.html' %}
{% block conteudo %}
<h2 class="mb-4 text-center">{{ contrato and 'Editar' or 'Novo' }} Contrato</h2>

<style>
  .form-control:focus, .form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    transition: all 0.2s;
  }

  @media (min-width: 768px) {
    .form-wrapper {
      max-width: 900px;
      margin: auto;
    }
  }
</style>

<form method="POST" class="form-wrapper">

  <!-- Tipo e Cliente -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label class="form-label">Tipo de contrato:</label>
      <select name="tipo" id="tipo" class="form-select" required onchange="mostrarCampos()">
        <option value="">Selecione</option>
        <option value="ensaio" {% if tipo == 'ensaio' %}selected{% endif %}>Ensaio</option>
        <option value="evento" {% if tipo == 'evento' %}selected{% endif %}>Evento</option>
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Cliente:</label>
      <select name="cliente_id" class="form-select" required>
        {% for cliente in clientes %}
          <option value="{{ cliente.id }}" {% if contrato and contrato.cliente_id == cliente.id %}selected{% endif %}>
            {{ cliente.nome }} / CPF: {{ cliente.cpf }}
          </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
        <label class="form-label">Valor:</label>
        <div class="input-group">
          <span class="input-group-text">R$</span>
          <input type="text" name="valor" id="valor" class="form-control" 
                value="{{ contrato.valor if contrato else '' }}" placeholder="0,00">
        </div>
    </div>
  </div>

  <!-- Campos ENSAIO -->
  <div id="campos_ensaio" style="display: none;">
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Data do ensaio:</label>
        <input type="date" name="data_ensaio" class="form-control" value="{{ contrato.data_ensaio if contrato else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Horário:</label>
        <input type="time" name="horario_ensaio" class="form-control" value="{{ contrato.horario_ensaio if contrato else '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Duração:</label>
        <input type="text" name="duracao_ensaio" class="form-control" placeholder="ex: 2h" value="{{ contrato.duracao_ensaio if contrato else '' }}">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label">Local:</label>
        <input type="text" name="local_ensaio" class="form-control" value="{{ contrato.local_ensaio if contrato else '' }}">
      </div>
      <div class="mb-3 col-md-4">
        <label class="form-label">Estado:</label>
        <select id="uf" name="uf" class="form-select" required></select>
      </div>
      <div class="mb-3 col-md-4">
        <label class="form-label">Cidade:</label>
        <select id="city" name="cidade_estado" class="form-select" required></select>
      </div>
    </div>
  </div>

  <!-- Campos EVENTO -->
  <div id="campos_evento" style="display: none;">
    <div class="row mb-3">
      <div class="col-12">
        <label class="form-label">Nome do evento:</label>
        <input type="text" name="nome_evento" class="form-control" value="{{ contrato.nome_evento if contrato else '' }}">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label class="form-label">Data do evento:</label>
        <input type="date" name="data_evento" class="form-control" value="{{ contrato.data_evento if contrato else '' }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Horário:</label>
        <input type="time" name="horario_evento" class="form-control" value="{{ contrato.horario_evento if contrato else '' }}">
      </div>
      <div class="mb-3 col-md-3">
        <label class="form-label">Estado:</label>
        <select id="uf" name="uf" class="form-select" required></select>
      </div>
      <div class="mb-3 col-md-3">
        <label class="form-label">Cidade:</label>
        <select id="city" name="cidade_estado" class="form-select" required></select>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-3">
        <label class="form-label">Local:</label>
        <input type="text" name="local_evento" class="form-control" value="{{ contrato.local_evento if contrato else '' }}">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label">Cobertura:</label>
        <input type="text" name="tempo_cobertura" class="form-control" placeholder="ex: até 4h" value="{{ contrato.tempo_cobertura if contrato else '' }}">
      </div>
      <div class="col-md-6">
        <label class="form-label">Fotógrafos:</label>
        <input type="number" name="qtd_fotografos" class="form-control" value="{{ contrato.qtd_fotografos if contrato else '' }}">
      </div>
    </div>
  </div>

  <!-- Descrição -->
  <div class="row mb-3">
    <div class="col-6">
      <label class="form-label">Descrição do serviço:</label>
      <textarea name="descricao_servico" rows="3" class="form-control">{{ contrato.descricao_servico if contrato else '' }}</textarea>
    </div>
    <div class="col-md-6">
      <label class="form-label">Forma de pagamento:</label>
      <textarea name="forma_pagamento" rows="3" class="form-control">{{ contrato.forma_pagamento if contrato else '' }}</textarea>
    </div>

  </div>

  <!-- Botões -->
  <div class="text-center">
    <button type="submit" class="btn btn-primary">{{ contrato and 'Atualizar' or 'Salvar' }} contrato</button>
    <a href="{{ url_for('listar_contratos') }}" class="btn btn-secondary">Cancelar</a>
  </div>
</form>

<script>
  function mostrarCampos() {
    const tipo = document.getElementById('tipo').value;
    document.getElementById('campos_ensaio').style.display = (tipo === 'ensaio') ? 'block' : 'none';
    document.getElementById('campos_evento').style.display = (tipo === 'evento') ? 'block' : 'none';
  }

  document.addEventListener("DOMContentLoaded", mostrarCampos);
</script>
{% endblock %}
