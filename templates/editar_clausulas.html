{% extends 'layout.html' %}
{% block conteudo %}
<h2 class="mb-4">Editar Cláusulas Personalizadas</h2>

<form method="POST">
  <div class="mb-3">
    <p>Selecione as cláusulas que deseja personalizar:</p>

    {% for numero, texto in clausulas.items() %}
      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="{{ numero }}" id="check_{{ numero }}" name="clausulas" onchange="toggleEditor('{{ numero }}')">
        <label class="form-check-label" for="check_{{ numero }}">
          {{ numero }}
        </label>
      </div>

      <div id="editor_{{ numero }}" class="mt-2 mb-4" style="display: none;">
        <label class="form-label">Texto da cláusula {{ numero }}:</label>
        <textarea name="clausula_{{ numero }}" class="form-control" rows="5">{% for c in contrato.clausulas_personalizadas if c.clausula_numero == numero %}{{ c.conteudo }}{% endfor %}</textarea>
      </div>
    {% endfor %}
  </div>

  <button type="submit" class="btn btn-primary">Salvar alterações</button>
  <a href="{{ url_for('visualizar_contrato', id=contrato.id) }}" class="btn btn-secondary">Cancelar</a>
</form>

<script>
  function toggleEditor(numero) {
    const checkbox = document.getElementById('check_' + numero);
    const editor = document.getElementById('editor_' + numero);
    editor.style.display = checkbox.checked ? 'block' : 'none';
  }

  // Mostrar editores já preenchidos ao carregar
  document.addEventListener("DOMContentLoaded", function () {
    {% for c in contrato.clausulas_personalizadas %}
      toggleEditor('{{ c.clausula_numero }}');
      document.getElementById('check_{{ c.clausula_numero }}').checked = true;
    {% endfor %}
  });
</script>
{% endblock %}
